{
  "api_name": "RedMesh Pentester API",
  "version": "0.8.2",
  "description": "Decentralized distributed pentesting API for the Ratio1.ai network. Orchestrates heterogeneous workers for port scanning, service detection, and web vulnerability testing.",
  "base_url": "http://{host}:{port}",
  "authentication": null,
  "endpoints": [
    {
      "name": "launch_test",
      "method": "POST",
      "path": "/launch_test",
      "description": "Start a new pentest job on the specified target. The job is announced to the network and executed asynchronously by distributed workers.",
      "parameters": {
        "target": {
          "type": "string",
          "required": true,
          "description": "Hostname or IP address to scan (e.g., 'scanme.nmap.org', '192.168.1.1')"
        },
        "start_port": {
          "type": "integer",
          "required": false,
          "default": 1,
          "min": 1,
          "max": 65535,
          "description": "Inclusive start of port range to scan"
        },
        "end_port": {
          "type": "integer",
          "required": false,
          "default": 65535,
          "min": 1,
          "max": 65535,
          "description": "Inclusive end of port range to scan"
        },
        "exceptions": {
          "type": "string",
          "required": false,
          "default": "64297",
          "description": "Comma or space separated list of ports to exclude from scanning (e.g., '22, 80, 443')"
        },
        "distribution_strategy": {
          "type": "string",
          "required": false,
          "default": "SLICE",
          "enum": ["SLICE", "MIRROR"],
          "description": "SLICE: Split port range across workers. MIRROR: All workers scan full range."
        },
        "port_order": {
          "type": "string",
          "required": false,
          "default": "SHUFFLE",
          "enum": ["SHUFFLE", "SEQUENTIAL"],
          "description": "SHUFFLE: Randomize port order (harder to detect). SEQUENTIAL: Scan ports in order."
        },
        "excluded_features": {
          "type": "array",
          "items": "string",
          "required": false,
          "default": [],
          "description": "List of feature method names to disable (e.g., ['_web_test_sql_injection', '_service_info_ftp'])"
        },
        "run_mode": {
          "type": "string",
          "required": false,
          "default": "SINGLEPASS",
          "enum": ["SINGLEPASS", "CONTINUOUS_MONITORING"],
          "description": "SINGLEPASS: One-time scan. CONTINUOUS_MONITORING: Repeated scans at interval."
        },
        "monitor_interval": {
          "type": "integer",
          "required": false,
          "default": 60,
          "unit": "seconds",
          "description": "Seconds between passes in CONTINUOUS_MONITORING mode"
        },
        "scan_min_delay": {
          "type": "float",
          "required": false,
          "default": 0.0,
          "unit": "seconds",
          "description": "Minimum random delay between operations (Dune sand walking for IDS evasion)"
        },
        "scan_max_delay": {
          "type": "float",
          "required": false,
          "default": 0.0,
          "unit": "seconds",
          "description": "Maximum random delay between operations (Dune sand walking for IDS evasion)"
        }
      },
      "response": {
        "job_specs": {
          "type": "object",
          "description": "Full job specification including job_id, target, workers, etc."
        },
        "worker": {
          "type": "string",
          "description": "Address of the worker that launched the job"
        },
        "other_jobs": {
          "type": "object",
          "description": "Other active jobs in the network"
        }
      },
      "example_request": {
        "target": "scanme.nmap.org",
        "start_port": 1,
        "end_port": 1000,
        "exceptions": "22, 80, 443",
        "distribution_strategy": "SLICE",
        "port_order": "SHUFFLE",
        "excluded_features": ["_web_test_sql_injection"],
        "run_mode": "SINGLEPASS",
        "scan_min_delay": 0.5,
        "scan_max_delay": 2.0
      },
      "example_response": {
        "job_specs": {
          "job_id": "a1b2c3d4",
          "target": "scanme.nmap.org",
          "start_port": 1,
          "end_port": 1000,
          "exceptions": [22, 80, 443],
          "launcher": "0xai_ABC123...",
          "workers": {
            "0xai_ABC123...": {"start_port": 1, "end_port": 500, "finished": false},
            "0xai_DEF456...": {"start_port": 501, "end_port": 1000, "finished": false}
          },
          "run_mode": "SINGLEPASS",
          "scan_min_delay": 0.5,
          "scan_max_delay": 2.0
        },
        "worker": "0xai_ABC123...",
        "other_jobs": {}
      }
    },
    {
      "name": "get_job_status",
      "method": "GET",
      "path": "/get_job_status",
      "description": "Retrieve the current status or final report of a pentest job.",
      "parameters": {
        "job_id": {
          "type": "string",
          "required": true,
          "description": "The job identifier returned from launch_test"
        }
      },
      "response_variants": [
        {
          "status": "completed",
          "description": "Job finished, report available",
          "fields": {
            "job_id": "string",
            "target": "string",
            "status": "completed",
            "report": {
              "type": "object",
              "description": "Worker reports keyed by local_worker_id"
            }
          }
        },
        {
          "status": "running",
          "description": "Job in progress",
          "fields": {
            "type": "object",
            "description": "Worker statuses keyed by local_worker_id with progress info"
          }
        },
        {
          "status": "network_tracked",
          "description": "Job exists in network but not running locally",
          "fields": {
            "job_id": "string",
            "target": "string",
            "status": "network_tracked",
            "job": "object"
          }
        },
        {
          "status": "not_found",
          "description": "Job does not exist",
          "fields": {
            "job_id": "string",
            "status": "not_found",
            "message": "string"
          }
        }
      ],
      "example_request_params": {
        "job_id": "a1b2c3d4"
      }
    },
    {
      "name": "list_features",
      "method": "GET",
      "path": "/list_features",
      "description": "List all available scanning and testing features that can be enabled/disabled.",
      "parameters": {},
      "response": {
        "features": {
          "type": "object",
          "description": "Features grouped by category",
          "categories": {
            "service_info": "Service detection methods (banner grabbing, protocol detection)",
            "web_test": "Web vulnerability tests (SQL injection, XSS, etc.)"
          }
        }
      },
      "example_response": {
        "features": {
          "service_info": [
            "_service_info_banner",
            "_service_info_ftp",
            "_service_info_ssh",
            "_service_info_http"
          ],
          "web_test": [
            "_web_test_sql_injection",
            "_web_test_xss",
            "_web_test_directory_traversal",
            "_web_test_headers"
          ]
        }
      }
    },
    {
      "name": "list_network_jobs",
      "method": "GET",
      "path": "/list_network_jobs",
      "description": "List all jobs tracked across the distributed network (from CStore).",
      "parameters": {},
      "response": {
        "type": "object",
        "description": "Jobs keyed by job_id with full specs including all worker states"
      }
    },
    {
      "name": "list_local_jobs",
      "method": "GET",
      "path": "/list_local_jobs",
      "description": "List jobs currently running on this specific worker node.",
      "parameters": {},
      "response": {
        "type": "object",
        "description": "Jobs keyed by job_id with local worker statuses"
      }
    },
    {
      "name": "stop_and_delete_job",
      "method": "GET",
      "path": "/stop_and_delete_job",
      "description": "Immediately stop a running job and remove it from tracking.",
      "parameters": {
        "job_id": {
          "type": "string",
          "required": true,
          "description": "The job identifier to stop"
        }
      },
      "response": {
        "status": {
          "type": "string",
          "enum": ["success"],
          "description": "Operation result"
        },
        "job_id": {
          "type": "string",
          "description": "The stopped job's identifier"
        }
      }
    },
    {
      "name": "stop_monitoring",
      "method": "POST",
      "path": "/stop_monitoring",
      "description": "Stop continuous monitoring for a job. Only applies to CONTINUOUS_MONITORING mode jobs.",
      "parameters": {
        "job_id": {
          "type": "string",
          "required": true,
          "description": "The job identifier"
        },
        "stop_type": {
          "type": "string",
          "required": false,
          "default": "SOFT",
          "enum": ["SOFT", "HARD"],
          "description": "SOFT: Complete current pass then stop. HARD: Stop immediately."
        }
      },
      "response": {
        "monitoring_status": {
          "type": "string",
          "enum": ["SCHEDULED_FOR_STOP", "STOPPED"],
          "description": "New monitoring status"
        },
        "stop_type": {
          "type": "string",
          "description": "The stop type that was applied"
        },
        "job_id": {
          "type": "string"
        },
        "passes_completed": {
          "type": "integer",
          "description": "Number of scan passes completed"
        },
        "pass_history": {
          "type": "array",
          "description": "History of completed passes with timestamps and report CIDs"
        }
      }
    },
    {
      "name": "get_report",
      "method": "GET",
      "path": "/get_report",
      "description": "Retrieve a full report from distributed storage (R1FS/IPFS) by its content identifier.",
      "parameters": {
        "cid": {
          "type": "string",
          "required": true,
          "description": "Content identifier (CID) of the report from R1FS"
        }
      },
      "response": {
        "cid": {
          "type": "string",
          "description": "The requested CID"
        },
        "report": {
          "type": "object",
          "description": "Full aggregated report data"
        }
      }
    }
  ],
  "data_models": {
    "job_specs": {
      "description": "Complete job specification stored in distributed CStore",
      "fields": {
        "job_id": "Unique 8-character identifier",
        "target": "Hostname or IP being scanned",
        "start_port": "Overall start port for the job",
        "end_port": "Overall end port for the job",
        "exceptions": "Array of excluded port numbers",
        "launcher": "Address of the node that created the job",
        "launcher_alias": "Human-readable name of launcher node",
        "created_at": "Unix timestamp of job creation",
        "workers": "Map of worker addresses to their assignments and status",
        "distribution_strategy": "SLICE or MIRROR",
        "port_order": "SHUFFLE or SEQUENTIAL",
        "excluded_features": "Array of disabled feature names",
        "enabled_features": "Array of active feature names",
        "run_mode": "SINGLEPASS or CONTINUOUS_MONITORING",
        "monitor_interval": "Seconds between passes (continuous mode)",
        "monitoring_status": "RUNNING, SCHEDULED_FOR_STOP, or STOPPED",
        "job_pass": "Current pass number (starts at 1)",
        "next_pass_at": "Unix timestamp for next pass (null if not scheduled)",
        "pass_history": "Array of completed pass records",
        "scan_min_delay": "Minimum random delay between operations",
        "scan_max_delay": "Maximum random delay between operations"
      }
    },
    "worker_report": {
      "description": "Report from a single local worker thread",
      "fields": {
        "job_id": "Job identifier",
        "local_worker_id": "Worker thread identifier (e.g., 'RM-1-a3f2')",
        "target": "Scanned target",
        "start_port": "First port in this worker's range",
        "end_port": "Last port in this worker's range",
        "ports_scanned": "Number of ports scanned",
        "open_ports": "Array of open port numbers found",
        "service_info": "Map of port -> service detection results",
        "web_tests_info": "Map of port -> web vulnerability test results",
        "completed_tests": "Array of completed test phase names",
        "progress": "Completion percentage string (e.g., '75.0%')",
        "done": "Boolean indicating completion",
        "canceled": "Boolean indicating if stopped early"
      }
    },
    "aggregated_report": {
      "description": "Combined report from all workers for a job",
      "fields": {
        "target": "Scanned target",
        "start_port": "Minimum port across all workers",
        "end_port": "Maximum port across all workers",
        "ports_scanned": "Total ports scanned across all workers",
        "open_ports": "Merged sorted array of all open ports found",
        "service_info": "Merged map of port -> service info",
        "web_tests_info": "Merged map of port -> web test results",
        "completed_tests": "Merged array of completed tests"
      }
    }
  },
  "workflows": {
    "basic_scan": {
      "description": "Simple one-time port scan",
      "steps": [
        {"action": "POST /launch_test", "params": {"target": "example.com", "start_port": 1, "end_port": 1000}},
        {"action": "Poll GET /get_job_status", "until": "status == 'completed'", "interval": "10s"},
        {"action": "Extract results from response.report"}
      ]
    },
    "stealth_scan": {
      "description": "Scan with IDS evasion (random delays)",
      "steps": [
        {"action": "POST /launch_test", "params": {"target": "example.com", "scan_min_delay": 1.0, "scan_max_delay": 5.0, "port_order": "SHUFFLE"}},
        {"action": "Poll GET /get_job_status", "note": "Will take longer due to delays"}
      ]
    },
    "continuous_monitoring": {
      "description": "Repeated scanning for change detection",
      "steps": [
        {"action": "POST /launch_test", "params": {"target": "example.com", "run_mode": "CONTINUOUS_MONITORING", "monitor_interval": 3600}},
        {"action": "Monitor via GET /get_job_status"},
        {"action": "POST /stop_monitoring when done", "params": {"job_id": "...", "stop_type": "SOFT"}}
      ]
    },
    "targeted_web_scan": {
      "description": "Focus on web vulnerabilities only",
      "steps": [
        {"action": "GET /list_features to see available tests"},
        {"action": "POST /launch_test", "params": {"target": "example.com", "start_port": 80, "end_port": 443, "excluded_features": ["_service_info_ftp", "_service_info_ssh"]}}
      ]
    }
  },
  "curl_examples": {
    "launch_basic_scan": "curl -X POST \"http://HOST:PORT/launch_test\" -H \"Content-Type: application/json\" -d '{\"target\": \"scanme.nmap.org\", \"start_port\": 1, \"end_port\": 1000}'",
    "launch_stealth_scan": "curl -X POST \"http://HOST:PORT/launch_test\" -H \"Content-Type: application/json\" -d '{\"target\": \"scanme.nmap.org\", \"start_port\": 1, \"end_port\": 100, \"scan_min_delay\": 1.0, \"scan_max_delay\": 3.0, \"port_order\": \"SHUFFLE\"}'",
    "launch_continuous": "curl -X POST \"http://HOST:PORT/launch_test\" -H \"Content-Type: application/json\" -d '{\"target\": \"scanme.nmap.org\", \"run_mode\": \"CONTINUOUS_MONITORING\", \"monitor_interval\": 300}'",
    "check_status": "curl \"http://HOST:PORT/get_job_status?job_id=a1b2c3d4\"",
    "list_features": "curl \"http://HOST:PORT/list_features\"",
    "list_all_jobs": "curl \"http://HOST:PORT/list_network_jobs\"",
    "stop_job": "curl \"http://HOST:PORT/stop_and_delete_job?job_id=a1b2c3d4\"",
    "stop_monitoring_soft": "curl -X POST \"http://HOST:PORT/stop_monitoring\" -H \"Content-Type: application/json\" -d '{\"job_id\": \"a1b2c3d4\", \"stop_type\": \"SOFT\"}'",
    "get_report_by_cid": "curl \"http://HOST:PORT/get_report?cid=QmXyz123...\""
  },
  "notes": {
    "authorization": "Ensure you have proper authorization before scanning any target. Only scan systems you own or have explicit permission to test.",
    "port_64297": "Port 64297 is the default Ratio1 network port and is excluded by default to avoid self-scanning.",
    "sand_walking": "The scan_min_delay and scan_max_delay parameters implement 'Dune sand walking' - random delays between operations to evade intrusion detection systems.",
    "distributed_execution": "Jobs are distributed across all configured chainstore_peers. Each peer handles its assigned port range independently.",
    "report_storage": "Full reports are stored in R1FS (IPFS-based) and only the CID is kept in CStore to avoid bloating distributed state."
  }
}